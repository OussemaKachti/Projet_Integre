{% extends 'baseAdmin.html.twig' %}

{% block title %}Sondage{% endblock %}

{% block body %}
   
  <!-- partial -->
  <div class="main-panel" style="width: 100%; max-width: 1200px; margin: 0 auto;">
    <div class="content-wrapper" style="width: 100%; max-width: 1200px; margin: 0 auto;">
      <div class="row" style="width: 100%; max-width: 1200px; margin: 0 auto;">
        <div class="col-lg-12 grid-margin stretch-card">
          <div class="card" style="width: 100%; max-width: 1200px; margin: 0 auto;">
            <div class="card-body" style="width: 100%; max-width: 1200px; margin: 0 auto;">
              <h4 class="card-title">Polls management</h4>
              <div class="table-responsive">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Question</th>
                      <th>Options</th>
                      <th>Club Name</th>
                      <th>Created At</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
            <tbody>
  {% for sondageItem in sondages %}
    <tr>
      <td>{{ sondageItem.sondage.id }}</td> <!-- Accède à l'ID du sondage -->
      <td>{{ sondageItem.sondage.question }}</td> <!-- Accède à la question du sondage -->
      <td>{{ sondageItem.sondage.choix|map(choice => choice.contenu)|join(', ') }}</td> <!-- Accède aux choix du sondage -->
      <td>{{ sondageItem.club_name }}</td> <!-- Affiche le nom du club -->
      <td>{{ sondageItem.sondage.createdAt|date('Y-m-d') }}</td> <!-- Formatte la date -->
      <td class="actions-column">
        <div class="action-buttons">
          <button class="bin-button" onclick="deletePoll({{ sondageItem.sondage.id }})">
            <svg class="bin-top" viewBox="0 0 39 7" fill="none" xmlns="http://www.w3.org/2000/svg">
              <line y1="5" x2="39" y2="5" stroke="white" stroke-width="4"></line>
              <line x1="12" y1="1.5" x2="26.0357" y2="1.5" stroke="white" stroke-width="3"></line>
            </svg>
            <svg class="bin-bottom" viewBox="0 0 33 39" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 6L12 29" stroke="white" stroke-width="4"></path>
              <path d="M21 6V29" stroke="white" stroke-width="4"></path>
            </svg>
          </button>
        </div>
      </td>
    </tr>
  {% endfor %}
</tbody>

<script>
  function deletePoll(sondageId) {
    if (confirm('Êtes-vous sûr de vouloir supprimer ce sondage ?')) {
      // Utiliser Fetch API pour envoyer une requête POST à l'URL de suppression
      fetch(`/sondage/${sondageId}/delete`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'  // Indiquer que c'est une requête Ajax
        },
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Erreur réseau');
        }
        return response.json();
      })
      .then(data => {
        console.log(data); // Afficher la réponse du serveur
        if (data.status === 'success') {
          alert('Sondage supprimé avec succès');
          location.reload();  // Recharger la page pour mettre à jour la liste des sondages
        } else {
          alert(data.message);
        }
      })
      .catch(error => {
        console.error(error); // Afficher l'erreur
        alert('Erreur lors de la suppression');
      });
    }
  }
</script>




                    <style>
                                                  /* Style pour les colonnes "Question" et "Options" */
                              .table-striped th:nth-child(2),  /* Colonne "Question" */
                              .table-striped td:nth-child(2),
                              .table-striped th:nth-child(3),  /* Colonne "Options" */
                              .table-striped td:nth-child(3) {
                                  max-width: 200px;  /* Définit la largeur maximale avant retour à la ligne */
                                  word-wrap: break-word;  /* Permet de couper les mots longs */
                                  overflow-wrap: break-word;
                                  white-space: normal;  /* Permet au texte de revenir à la ligne */
                              }

                              /* Styles pour les boutons d'action */
                              .actions-column {
                                text-align: center;
                              }

                              .action-buttons {
                                display: flex;
                                align-items: center; /* Centre verticalement */
                                justify-content: center; /* Centre horizontalement */
                                gap: 10px; /* Espacement entre les boutons */
                              }

                              /* Style pour le bouton plus */
                              .plusButton {
                                /* Configurations de dimensions */
                                --plus_sideLength: 1.8rem;
                                --plus_topRightTriangleSideLength: 0.5rem;
                                
                                position: relative;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                border: 1px solid white;
                                width: var(--plus_sideLength);
                                height: var(--plus_sideLength);
                                background-color: #000000;
                                overflow: hidden;
                              }

                              .plusButton::before {
                                position: absolute;
                                content: "";
                                top: 0;
                                right: 0;
                                width: 0;
                                height: 0;
                                border-width: 0 var(--plus_topRightTriangleSideLength) var(--plus_topRightTriangleSideLength) 0;
                                border-style: solid;
                                border-color: transparent white transparent transparent;
                                transition-timing-function: ease-in-out;
                                transition-duration: 0.2s;
                              }

                              .plusButton:hover {
                                cursor: pointer;
                              }

                              .plusButton:hover::before {
                                --plus_topRightTriangleSideLength: calc(var(--plus_sideLength) * 2);
                              }

                              .plusButton:focus-visible::before {
                                --plus_topRightTriangleSideLength: calc(var(--plus_sideLength) * 2);
                              }

                              .plusButton>.plusIcon {
                                fill: white;
                                width: calc(var(--plus_sideLength) * 0.7);
                                height: calc(var(--plus_sideLength) * 0.7);
                                z-index: 1;
                                transition-timing-function: ease-in-out;
                                transition-duration: 0.2s;
                              }

                              .plusButton:hover>.plusIcon {
                                fill: black;
                                transform: rotate(180deg);
                              }

                              .plusButton:focus-visible>.plusIcon {
                                fill: black;
                                transform: rotate(180deg);
                              }

                              /* Styles pour le bouton "bin" */
                              .bin-button {
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                width: 25px;
                                height: 25px;
                                border-radius: 5px;
                                background-color: rgb(255, 95, 95);
                                cursor: pointer;
                                border: 3px solid rgb(255, 201, 201);
                                transition-duration: 0.3s;
                              }

                              .bin-bottom {
                                width: 15px;
                              }

                              .bin-top {
                                width: 17px;
                                transform-origin: right;
                                transition-duration: 0.3s;
                              }

                              .bin-button:hover .bin-top {
                                transform: rotate(45deg);
                              }

                              .bin-button:hover {
                                background-color: rgb(255, 0, 0);
                              }

                              .bin-button:active {
                                transform: scale(0.9);
                              }

                    </style>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
