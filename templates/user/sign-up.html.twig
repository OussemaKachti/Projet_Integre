{% extends 'base.html.twig' %}
{% block title %}New User{% endblock %}

{% block body %}
    <!-- back to top start -->
    <div class="progress-wrap">
        <svg class="progress-circle svg-content" width="100%" height="100%" viewbox="-1 -1 102 102">
            <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
        </svg>
    </div>
    <!-- back to top end -->

    <!-- sign up area start -->
    <section class="signup__area p-relative z-index-1 pt-100 pb-145">
        <div class="sign__shape">
            <img class="man-1" src="{{ asset('front_assets/img/icon/sign/man-3.png') }}" alt="">
            <img class="man-2 man-22" src="{{ asset('front_assets/img/icon/sign/man-2.png') }}" alt="">
            <img class="circle" src="{{ asset('front_assets/img/icon/sign/circle.png') }}" alt="">
            <img class="zigzag" src="{{ asset('front_assets/img/icon/sign/zigzag.png') }}" alt="">
            <img class="dot" src="{{ asset('front_assets/img/icon/sign/dot.png') }}" alt="">
            <img class="bg" src="{{ asset('front_assets/img/icon/sign/sign-up.png') }}" alt="">
            <img class="flower" src="{{ asset('front_assets/img/icon/sign/flower.png') }}" alt="">
        </div>
        <div class="container">
            <div class="row">
                <div class="col-xxl-8 offset-xxl-2 col-xl-8 offset-xl-2">
                    <div class="section__title-wrapper text-center mb-55">
                        <h2 class="section__title">Join Us Today â€“ Create Your Free Account!</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xxl-6 offset-xxl-3 col-xl-6 offset-xl-3 col-lg-8 offset-lg-2">
                    <!-- Content moderation alerts - ONLY showing flash messages -->
                    <div id="alerts-container">
                        {% for label, messages in app.flashes %}
                            {% for message in messages %}
                                <div class="alert alert-{{ label == 'error' ? 'danger' : label }} mb-4">
                                    {% if label == 'error' %}
                                        <strong><i class="fas fa-exclamation-triangle"></i> Content Alert:</strong> 
                                    {% elseif label == 'success' %}
                                        <strong><i class="fas fa-check-circle"></i> Success:</strong> 
                                    {% else %}
                                        <strong><i class="fas fa-info-circle"></i> Info:</strong> 
                                    {% endif %}
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    
                    <div class="sign__wrapper white-bg">
                        <div class="sign__form">
                            <style>
                                .sign__input {
                                    position: relative;
                                    margin-bottom: 5px;
                                }
                                .sign__input-wrapper {
                                    margin-bottom: 15px;
                                }
                                .form-error-message {
                                    color: #dc3545;
                                    font-weight: normal;
                                    font-size: 14px;
                                    margin-bottom: 10px;
                                    display: block;
                                }
                                .toggle-password {
                                    position: absolute;
                                    right: 15px;
                                    top: 50%;
                                    transform: translateY(-50%);
                                    cursor: pointer;
                                    z-index: 5;
                                }
                                .sign__input i.fal {
                                    position: absolute;
                                    top: 50%;
                                    transform: translateY(-50%);
                                    left: 15px;
                                    z-index: 1;
                                }
                                .sign__input input {
                                    padding-left: 45px !important;
                                    padding-right: 40px !important;
                                }
                                .password-requirements {
                                    color: #6c757d;
                                    font-size: 12px;
                                    margin-top: 5px;
                                    margin-bottom: 15px;
                                }
                                .alert {
                                    border-radius: 5px;
                                    padding: 12px 15px;
                                }
                                .alert-danger {
                                    background-color: #f8d7da;
                                    border-color: #f5c6cb;
                                    color: #721c24;
                                }
                                .alert-success {
                                    background-color: #d4edda;
                                    border-color: #c3e6cb;
                                    color: #155724;
                                }
                                .input-error {
                                    border-color: #dc3545 !important;
                                }
                                .input-error-icon {
                                    position: absolute;
                                    right: 10px;
                                    top: 50%;
                                    transform: translateY(-50%);
                                    color: #dc3545;
                                }
                            </style>
                            
                            {# Start form with render_rest=false to prevent automatic error rendering #}
                            {{ form_start(form, {'attr': {'class': 'signup-form','novalidate':'novalidate'}, 'render_rest': false}) }}
                            
                           {# For First Name field (nom) #}
<div class="sign__input-wrapper">
    <h5>{{ 'First Name'|trans }}</h5>
    <div class="sign__input">
        <i class="fal fa-user"></i>
        {{ form_widget(form.nom, {
            'attr': {
                'placeholder': 'First name',
                'class': form.nom.vars.errors|length > 0 ? 'form-control input-error' : 'form-control'
            }
        }) }}
        {% if form.nom.vars.errors|length > 0 %}
            <span class="input-error-icon">
                <i class="fas fa-exclamation-circle"></i>
            </span>
        {% endif %}
    </div>
    {% if form.nom.vars.errors|length > 0 %}
        <div class="form-error-message">
            {% for error in form.nom.vars.errors %}
                {% if error.message starts with 'First name' %}
                    {{ error.message }}
                    {% if not loop.last %}<br>{% endif %}
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
</div>

{# For Last Name field (prenom) #}
<div class="sign__input-wrapper">
    <h5>{{ 'Last Name'|trans }}</h5>
    <div class="sign__input">
        <i class="fal fa-user"></i>
        {{ form_widget(form.prenom, {
            'attr': {
                'placeholder': 'Last name',
                'class': form.prenom.vars.errors|length > 0 ? 'form-control input-error' : 'form-control'
            }
        }) }}
        {% if form.prenom.vars.errors|length > 0 %}
            <span class="input-error-icon">
                <i class="fas fa-exclamation-circle"></i>
            </span>
        {% endif %}
    </div>
    {% if form.prenom.vars.errors|length > 0 %}
        <div class="form-error-message">
            {% for error in form.prenom.vars.errors %}
                {% if error.message starts with 'Last name' %}
                    {{ error.message }}
                    {% if not loop.last %}<br>{% endif %}
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
</div>

                            <div class="sign__input-wrapper">
                                <h5>{{ form.email.vars.label }}</h5>
                                <div class="sign__input">
                                    <i class="fal fa-envelope"></i>
                                    {{ form_widget(form.email, {
                                        'attr': {
                                            'placeholder': 'Email address',
                                            'class': form.email.vars.errors|length > 0 ? 'form-control input-error' : 'form-control'
                                        }
                                    }) }}
                                    {% if form.email.vars.errors|length > 0 %}
                                        <span class="input-error-icon">
                                            <i class="fas fa-exclamation-circle"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                {% if form.email.vars.errors|length > 0 %}
                                    <div class="form-error-message">
                                        {% for error in form.email.vars.errors %}
                                            {{ error.message }}
                                            {% if not loop.last %}<br>{% endif %}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="sign__input-wrapper">
                                <h5>{{ form.password.vars.label }}</h5>
                                <div class="sign__input password-field">
                                    <i class="fal fa-lock"></i>
                                    {{ form_widget(form.password, {
                                        'attr': {
                                            'placeholder': 'Password',
                                            'class': form.password.vars.errors|length > 0 ? 'form-control input-error' : 'form-control'
                                        }
                                    }) }}
                                    <span class="toggle-password">
                                        <i class="fa fa-eye"></i>
                                    </span>
                                </div>
                                {% if form.password.vars.errors|length > 0 %}
                                    <div class="form-error-message">
                                        {% for error in form.password.vars.errors %}
                                            {{ error.message }}
                                            {% if not loop.last %}<br>{% endif %}
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="password-requirements">
                                        Password must include uppercase, lowercase, numbers, and special characters
                                    </div>
                                {% endif %}
                            </div>

                            <div class="sign__input-wrapper">
                                <h5>{{ 'Phone Number'|trans }}</h5>
                                <div class="sign__input">
                                    <i class="fal fa-phone"></i>
                                    {{ form_widget(form.tel, {
                                        'attr': {
                                            'placeholder': 'Phone number',
                                            'class': form.tel.vars.errors|length > 0 ? 'form-control input-error' : 'form-control'
                                        }
                                    }) }}
                                    {% if form.tel.vars.errors|length > 0 %}
                                        <span class="input-error-icon">
                                            <i class="fas fa-exclamation-circle"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                {% if form.tel.vars.errors|length > 0 %}
                                    <div class="form-error-message">
                                        {% for error in form.tel.vars.errors %}
                                            {{ error.message }}
                                            {% if not loop.last %}<br>{% endif %}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="sign__action d-flex justify-content-between mb-30">
                                <div class="sign__agree d-flex align-items-center">
                                    <input class="m-check-input" type="checkbox" id="m-agree" required>
                                    <label class="m-check-label" for="m-agree">I agree to the
                                        <a href="#">Terms & Conditions</a>
                                    </label>
                                </div>
                            </div>

                            {# Render any hidden fields #}
                            {{ form_rest(form) }}

                            <button class="tp-btn w-100" type="submit">Sign Up</button>
                            <div class="sign__new text-center mt-20">
                                <p>Already have an account? <a href="{{ path('app_login') }}">Sign In</a></p>
                            </div>

                            {{ form_end(form) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
   document.addEventListener('DOMContentLoaded', function() {
    // Add smooth scrolling to alerts when they exist
    const alertsContainer = document.getElementById('alerts-container');
    if (alertsContainer && alertsContainer.children.length > 0) {
        alertsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Fixed password toggle functionality
    const passwordField = document.querySelector('.password-field input');
    const toggleButton = document.querySelector('.toggle-password');
    
    if (passwordField && toggleButton) {
        // Ensure initial state is correct
        toggleButton.querySelector('i').classList.add('fa-eye');
        
        toggleButton.addEventListener('click', function(e) {
            // Prevent the click from submitting the form
            e.preventDefault();
            
            // Toggle the password field visibility
            if (passwordField.getAttribute('type') === 'password') {
                passwordField.setAttribute('type', 'text');
                toggleButton.querySelector('i').classList.remove('fa-eye');
                toggleButton.querySelector('i').classList.add('fa-eye-slash');
            } else {
                passwordField.setAttribute('type', 'password');
                toggleButton.querySelector('i').classList.remove('fa-eye-slash');
                toggleButton.querySelector('i').classList.add('fa-eye');
            }
        });
    }
    
    // Required checkbox validation
    const form = document.querySelector('.signup-form');
    const agreeCheckbox = document.getElementById('m-agree');
    
    if (form && agreeCheckbox) {
        form.addEventListener('submit', function(event) {
            if (!agreeCheckbox.checked) {
                event.preventDefault();
                alert('You must agree to the Terms & Conditions to proceed.');
            }
        });
    }
});
    </script>
    {% include 'user/terms-modal.html.twig' %}
{% endblock %}